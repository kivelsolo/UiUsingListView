apply {
    plugin 'com.android.application'
    from 'version.gradle'
    from 'compile.gradle'
}

def keystorePropertiesFile = rootProject.file("keystore.properties")
// Initialize a new Properties() object
def keystoreProperties = new Properties()
// Load keystore.properties file into the keystoreProperties object.
keystoreProperties.load(new FileInputStream(keystorePropertiesFile))

android {
    signingConfigs {
        ZekeSigned {
            keyAlias keystoreProperties['keyAlias']
            keyPassword keystoreProperties['keyPassword']
            storeFile file(keystoreProperties['storeFile'])
            storePassword keystoreProperties['storePassword']
        }
    }
    compileSdkVersion rootProject.ext.android.compileSdkVersion
    buildToolsVersion rootProject.ext.android.buildToolsVersion


    //>=6.0 使用HttpClient
    useLibrary 'org.apache.http.legacy'

    //The default configuration, inherited by all product flavors(if any are defined)
    defaultConfig {
        applicationId 'com.kingz.customdemo'
        multiDexEnabled false
        versionCode rootProject.ext.android.versionCode
        versionName rootProject.ext.android.versionName
        //unit test
        testInstrumentationRunner 'android.support.test.runner.AndroidJUnitRunner'
        signingConfig signingConfigs.ZekeSigned
        minSdkVersion 19
        targetSdkVersion 22
        buildConfigField("String", "APP_NAME", "\"STARCOR\"")
    }

    // Specifies one flavor dimension.
    flavorDimensions "version"
//    productFlavors{
//        demo {
//            // Assigns this product flavor to the "version" flavor dimension.
//            // This property is optional if you are using only one dimension.
//            dimension "version"
//            applicationIdSuffix ".demo"
//            versionNameSuffix "-2019"
//            versionCode appVersionCode
//            versionName appVersionName
//            buildConfigField("String", "APP_NAME", "\"STARCOR\"")
//            buildConfigField 'String','MAIN_URL','"http://www.starcor.com"'
//        }
//
//        full {
//            dimension "version"
//            applicationIdSuffix ".full"
//            versionNameSuffix "-2019"
//            versionCode appVersionCode
//            versionName appVersionName
//            buildConfigField("String", "APP_NAME", "\"STARCOR\"")
//            buildConfigField 'String','MAIN_URL','"http://www.starcor.com"'
//        }
//    }

    buildTypes {
        debug {
//            buildConfigField "boolean", "LOG_DEBUG", "false" //不显示log
            zipAlignEnabled true
//            minifyEnabled true
//            shrinkResources true
//            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.txt'
        }
        release {
            zipAlignEnabled true
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.txt'
            signingConfig signingConfigs.ZekeSigned

            //自动清理掉未使用资源  打开后，会在构建的时候检查所有资源，
            // 看看哪些未被引用。包括第三方apk的。 (但好像有问题)
//            shrinkResources true
        }
    }

    configurations {
    }

    compileOptions {
        encoding compile_encoding
        sourceCompatibility compile_source_compatibility
        targetCompatibility compile_target_compatibility
    }

    adbOptions{
    }

    packagingOptions {
        doNotStrip '*/mips/*.so'
        doNotStrip '*/mips64/*.so'
    }

}

configurations.all {
    resolutionStrategy.force 'com.android.support:support-annotations:27.1.1'
}

dependencies {
    implementation fileTree(include: ['*.jar'], dir: 'libs')
    implementation 'com.google.code.gson:gson:2.8.5'
    implementation 'com.github.bumptech.glide:glide:3.7.0'
    //OKHttp 2.X
    implementation 'com.squareup.okhttp:okhttp:2.4.0'
//    implementation 'com.squareup.okio:okio:1.5.0'
    //OKHttp 3.X
    implementation 'com.squareup.okhttp3:okhttp:3.12.0'
    implementation 'com.squareup.okio:okio:2.1.0'

    //FAB
    implementation 'com.getbase:floatingactionbutton:1.10.1'

    implementation 'cn.bmob.android:bmob-sdk:3.7.2'
    implementation "io.reactivex.rxjava2:rxjava:2.2.2"
    implementation 'io.reactivex.rxjava2:rxandroid:2.1.0'
    implementation 'com.android.support.constraint:constraint-layout:1.1.3'
    implementation 'com.android.support:support-v4:27.1.1'
    implementation 'com.android.support:recyclerview-v7:27.1.1'
    implementation 'com.android.support:appcompat-v7:27.1.1'
    implementation project(path: ':views-library')

    //-----------------Exo Player-------------------------
    implementation 'com.google.android.exoplayer:exoplayer:2.7.0'



    //for local tests
    testImplementation 'junit:junit:4.12'
    // Mockito framework
    testImplementation 'org.mockito:mockito-core:1.10.19'
    //for instrumentation tests
    androidTestImplementation 'org.mockito:mockito-core:1.10.19'
    androidTestImplementation "com.google.dexmaker:dexmaker:1.2"
    androidTestImplementation "com.google.dexmaker:dexmaker-mockito:1.2"
    androidTestImplementation 'com.android.support.test:runner:1.0.2'
    androidTestImplementation 'com.android.support.test:rules:1.0.2'
    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'
    androidTestImplementation 'com.android.support:support-annotations:25.3.1'
}

gradle.taskGraph.whenReady {
    graph ->  println('>>>>>> taskGraph is ready! Config finished.')
}

gradle.buildFinished {
    result -> println('>>>>>> all buildFinished!.')
}

/**
 * 表示所有的模块都已经配置完
 * 可以准备执行task
 */
project.afterEvaluate {
    logger.log(LogLevel.ERROR,'>>>>> Evaluate End')
    logger.log(LogLevel.ERROR, assemble.getTaskDependencies().toString())
    logger.log(LogLevel.ERROR, assemble.getTaskDependencies().getDependencies().toString())
    /** 遍历构建遍历 可以根据构建类型进行任务处理 */
//    android.libraryVariants.each{ variant ->
//
//    }
}

logger.log(LogLevel.DEBUG, ">>>>>>>>>>> app config End")


